<!DOCTYPE html>
<html lang="fr" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Séances de sport</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap">
    <link rel="stylesheet" href="style.css">
    <style>
        #controls { text-align: center; margin-bottom: 20px; }
        #controls button { background: linear-gradient(90deg, var(--accent), #34c759); color:#fff; border:none; border-radius:20px; padding:6px 16px; }
        .session button { background: linear-gradient(90deg, var(--accent), #34c759); color:#fff; border:none; border-radius:6px; width:28px; height:28px; margin-left:4px; display:flex; align-items:center; justify-content:center; }
        dialog form { display:flex; flex-direction:column; gap:8px; }
        dialog button { background: linear-gradient(90deg, var(--accent), #34c759); color:#fff; border:none; border-radius:20px; padding:6px 12px; margin-right:4px; }
    </style>
</head>
<body>
<header>
    <nav class="top-nav">
        <a href="index.html"><i class="fas fa-home"></i> Accueil</a>
        <a href="sport.html"><i class="fas fa-futbol"></i> Sport</a>
        <a href="stats.html"><i class="fas fa-chart-bar"></i> Stats</a>
        <button id="toggle-theme"><i class="fas fa-moon"></i></button>
    </nav>
</header>
<h1>Séances de sport</h1>
<div id="controls">
    <button id="add">Ajouter une séance</button>
</div>
<div id="list"></div>
<dialog id="modal">
    <form id="form">
        <label>Date: <input type="date" id="date" required></label>
        <label>Sport: <input type="text" id="sport" required></label>
        <label>Détail:<br><textarea id="detail"></textarea></label>
        <div>
            <button type="submit">Enregistrer</button>
            <button type="button" id="cancel">Annuler</button>
        </div>
    </form>
</dialog>
<script>
const categories = {
    "Santé": [
        "Sport",
        "Petit déjeuner équilibré",
        "Déjeuner équilibré",
        "Dîner équilibré",
        "Pas de grignotage"
    ],
    "Réseaux sociaux": [
        "Post Tiktok lolo.puzzle",
        "Post Tiktok LBB",
        "Post Tiktok mymy.puzzle",
        "Post Tiktok footballteamlogocircle",
        "Post Tiktok kanoodle_addict",
        "Post Tiktok kanoodle_experience",
        "Post Instagram LBB",
        "Post Instagram bretagnifique",
        "Post Instagram lolo.puzzle"
    ],
    "Formation": [
        "Formation Anglais",
        "Formation Codex / ChatGPT"
    ],
    "Autre": [
        "Lire 15 min",
        "Regarder un épisode série",
        "Tâche ménagère",
        "Jouer avec les enfants"
    ]
};
const tasks = Object.values(categories).flat();
const sportIndex = tasks.indexOf('Sport');
function setThemeIcon(th){
    document.getElementById('toggle-theme').innerHTML = th==='dark' ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
}
function initTheme(){
    const th=localStorage.getItem('theme')||'dark';
    document.documentElement.setAttribute('data-theme',th);
    setThemeIcon(th);
}
function loadSessions(){
    return JSON.parse(localStorage.getItem('sport_sessions')||'[]');
}
function saveSessions(s){
    localStorage.setItem('sport_sessions',JSON.stringify(s));
}
function render(){
    const list=document.getElementById('list');
    const sessions=loadSessions().sort((a,b)=>new Date(a.date)-new Date(b.date));
    list.innerHTML='';
    const today=new Date().toISOString().split('T')[0];
    sessions.forEach((s,idx)=>{
        const div=document.createElement('div');
        div.className='session';
        if(new Date(s.date)<=new Date()){
            const st=JSON.parse(localStorage.getItem('tasks_'+s.date)||'[]');
            if(st[sportIndex]) div.classList.add('done');
        }
        const date=document.createElement('span');
        date.textContent=s.date;
        const sport=document.createElement('span');
        sport.textContent=s.sport;
        const detail=document.createElement('span');
        detail.textContent=s.detail;
        const edit=document.createElement('button');
        edit.innerHTML='<i class="fas fa-edit"></i>';
        edit.addEventListener('click',()=>openModal(idx));
        const del=document.createElement('button');
        del.innerHTML='<i class="fas fa-trash-alt"></i>';
        del.addEventListener('click',()=>{if(confirm('Supprimer ?')){const ss=loadSessions();ss.splice(idx,1);saveSessions(ss);render();}});
        div.appendChild(date);div.appendChild(sport);div.appendChild(detail);div.appendChild(edit);div.appendChild(del);
        list.appendChild(div);
    });
}
function openModal(idx){
    const modal=document.getElementById('modal');
    const form=document.getElementById('form');
    const sessions=loadSessions();
    if(idx!=null){
        const s=sessions[idx];
        form.dataset.idx=idx;
        document.getElementById('date').value=s.date;
        document.getElementById('sport').value=s.sport;
        document.getElementById('detail').value=s.detail;
    }else{
        delete form.dataset.idx;
        document.getElementById('date').value=new Date().toISOString().split('T')[0];
        document.getElementById('sport').value='';
        document.getElementById('detail').value='';
    }
    modal.showModal();
}
document.getElementById('add').addEventListener('click',()=>openModal());
document.getElementById('cancel').addEventListener('click',()=>document.getElementById('modal').close());
document.getElementById('form').addEventListener('submit',e=>{
    e.preventDefault();
    const sessions=loadSessions();
    const idx=e.target.dataset.idx;
    const data={date:document.getElementById('date').value,sport:document.getElementById('sport').value,detail:document.getElementById('detail').value};
    if(idx!=null){sessions[idx]=data;}else{sessions.push(data);}
    saveSessions(sessions);document.getElementById('modal').close();render();
});
document.getElementById('toggle-theme').addEventListener('click',()=>{
    const current=document.documentElement.getAttribute('data-theme');
    const next=current==='dark'?'light':'dark';
    document.documentElement.setAttribute('data-theme',next);
    localStorage.setItem('theme',next);
    setThemeIcon(next);
});
const currentPage = location.pathname.split('/').pop() || 'index.html';
document.querySelectorAll('.top-nav a').forEach(a=>{
    if(a.getAttribute('href')===currentPage){
        a.classList.add('active');
    }
});
initTheme();
render();
</script>
</body>
</html>
